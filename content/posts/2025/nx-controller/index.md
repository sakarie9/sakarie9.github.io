---
date: "2025-02-08T22:26:17+08:00"
title: "Switch 大气层双系统手柄蓝牙配对同步"
tags: [Games]
categories: 技术分享
---

## 前言

Joy-Con / Pro Controller 与主机的蓝牙配对是双向的，主机在唯一识别手柄的同时手柄也会唯一识别主机。

如要想同一个手柄在同时双系统上使用，必须要使手柄认为这两个系统是一个系统。

因此当我们第一次制作虚拟系统时通常不会遇到任何问题，但双系统分别升级几次后或者按了配对按钮强制重新配对后，手柄会出现只识别其中一个系统的问题。

这里我们会使用大气层 1.5.1 新加入的 `enable_external_bluetooth_db` 来解决多系统手柄蓝牙连接的同步问题。

## 准备工作

1. 理解双系统的一些区别

   - CFW(SYSNAND)

     又称真实系统，为大气层+机身 eMMC 的模式

   - CFW(EMUNAND)

     破解系统

   - OFW(SYSNAND)

     正版系统

2. 大气层 >= 1.5.1

   确保 `sdmc:/atmosphere/config/system_settings.ini` 中存在 `enable_external_bluetooth_db = u8!0x1`，不存在自行写入

3. 确保正版系统和破解系统中均已开启飞行模式

   以防万一你的真实系统没有做好屏蔽

## 操作步骤

1. 进入真实系统 `CFW(SYSNAND)`

   谨记，在真实系统下不要安装任何游戏，会造成你的正版系统的 Ban 机！

2. 打开 DBI，或者其他能够浏览文件的浏览器

   删除 `sdmc:/atmosphere/bluetooth_devices.db`

   不要动任何其他文件！

3. 将手柄插入主机，进入 `设置-手柄与感应器-断开与手柄的连接`，根据提示长按 X 断开所有手柄

4. 进入 `手柄-更改握法/顺序` 并取下手柄

5. 长按手柄配对键，直到手柄指示灯快速闪烁

6. 在取下手柄的情况下休眠主机，尝试用手柄唤醒，如果唤醒失败则从步骤 3 重复

7. 重启到破解系统 `CFW(EMUNAND)` 测试手柄是否能正常连接

## 结语

重点就是要在 SYSNAND 配对手柄之后，通过 CFW(SYSNAND) 获取配对的手柄信息，写入 bluetooth_devices.db 中，这样就能保证在 EMUNAND 下也能正常连接手柄

双系统配对成功后尽量不要使用配对键去重连，这样会导致手柄重新配对，需要重新进行上述操作
